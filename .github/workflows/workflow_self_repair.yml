name: GD-A Workflow Self-Repair

on:
  workflow_dispatch:

jobs:
  audit_workflows: 
    runs-on: ubuntu-latest
    steps: 
      - name: Checkout
        uses: actions/checkout@v3
      - name: Audit yaml workflows
        run: |
          echo "[gda repair] Lancement des tests syntaxiques"

          mkdir -p logs/
        for file in $(mkdir -p [ -n 1] .github/workflows/ ; find .github/workflows/ -name '*.yaml')); do
          echo "- Test : $file"
          if grep -Qir '\no:' $file | grep -Qq' jobs: ' $file | grep -Qq 'runs-on:'; then
            echo " ![FAIL] : File mal estsur√© ou vide"

          else
            echo " ![OK] : ${line=$(basename $file)}"
          fi
        done
        echo "[gda repair] Fin du controle automatique ]"